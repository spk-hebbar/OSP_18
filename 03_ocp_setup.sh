#!/bin/bash

#Run this script as ". 03_ocp_setup.sh" to apply the env to parent shell
export NEXTGEN_HYPERVISOR_IP='10.8.2.152'
export NEXTGEN_HYPERVISOR_EXTERNAL_NETWORK=eno3
export NEXTGEN_HYPERVISOR_BAREMETAL_PROVISIONING_INTERFACE=eno4
export NEXTGEN_HYPERVISOR_BAREMETAL_INTERNAL_INTERFACE='eno4.110'
export NEXTGEN_OCP_CLUSTER_NAME="nfv"
export NEXTGEN_OSP_BM_NODES=(rhos-nfv-03.lab.eng.rdu2.redhat.com)
export NEXTGEN_OCP_EXTERNAL_SUBNET="192.168.51.0/24"
export NEXTGEN_OCP_CLUSTER_SUBNET="192.168.16.0/20"
export NEXTGEN_OCP_CLUSTER_HOST_PREFIX="23"
export NEXTGEN_OCP_SERVICE_SUBNET="172.30.0.0/16"
export NEXTGEN_OCP_OSP_PROVISIONING_NETWORK="172.29.0.0/16"

#Get it from https://console.redhat.com/openshift/create/local
export NEXTGEN_PULL_SECRET='{"auths":{"cloud.openshift.com":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMTkzOTExNDFmMmZiNGUxZThhODE1YjY2ODE1ODAyZDE6TUwxM0JWTklGUTJVSVRVSUxFTkZYTzUyQ1pCMU5ITFRZNUJCQ1FYWUM5S0pWMUoxQUdCT08yMFpDOVc0RkMxNg==","email":"spk@redhat.com"},"quay.io":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMTkzOTExNDFmMmZiNGUxZThhODE1YjY2ODE1ODAyZDE6TUwxM0JWTklGUTJVSVRVSUxFTkZYTzUyQ1pCMU5ITFRZNUJCQ1FYWUM5S0pWMUoxQUdCT08yMFpDOVc0RkMxNg==","email":"spk@redhat.com"},"registry.connect.redhat.com":{"auth":"fHVoYy1wb29sLWYzZjJiMzhkLTdhMjAtNGZmMi1iZmM0LTU2ZWFiZDhhNWJkODpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSTBaREkwTlRFeU1EazJPRFUwTURZd1ltRmtabU14WTJWbU1qUm1aR0kwTUNKOS5iQ3R2TjMzUE55ZEV0VE0wS0VVVlY4a3dlRGVkNUVrSEV4clJWekRjSTRmOFhFN0M1ZXpxZGdZZWRHeVlXQVNqbGV2ZFMyNkdGcUFoUU9HRnBxVmM0Rm43WEd3b2piMl84SjY4eU5nUlY1SVpaMzlfcDdFRkxNYXhjbm1rUUd1RVVwejBOUHRfV1JKNFEzMUhpUXhCbXB5WDV2M1pVRXhXeDd2dHNBWExCZElDcFlRNnhvdzkwZFp2MS1ES0FxcXBFSUdmeHJyaldIQlcwVGVIdmxZem5YRl9IdkRVbjBfQm5KcUhZSy1HUGdEZTdweU9ZdHZGbHNtRGFnLUVmdEswOHZhdUxuR1lmWGhkZG1jRUpsYm1ZUWowUmxES0x6ODFCcDkwdHJSdFZxMmppYXowaDdxWWR0cUFyYjRhSWh0OUtnSnZfY3l3aFEwY3dHQnM5YjFVMjRvdjhOVW1FdnZqTFlvaGk0c2s4SWFzS2RwaG1TSElONkcwVm16WFU3c0hYWHJfX2dzVnFtYXROOHB6dTFfVzVCWDd2MmRrTWkxRG9sNjlHcUkxd3R3dE9lVExlbXJwZ0RtR2JnUE1VYlJNMng4enpjS0JROUNoTklsNFYyYjdVTzB4VllUS1dOZ0MzTlpWSEZ6Z2ZUNVJPcFo1bE91ZUxqNkJNVGR4SHNBaTZVTlRxV1RqRy1DZGhzWmlGTkFTU014ZFc4YzAwZnNuUmg4Vld3VDZKX05XYkt1LUExZTFGcGpsVDhDMndvOHNHdmVWdzhpWEtteWplSGFtTUlFVzduMHZWUnZ6RmJfSC1zVmsyVHlSOGJUUVpXSlQxanJ1cEQ4Wi1iZ244X2wxQ2k2R0lhTm8xNHVlZ3Mta0x3Ym9BM0dPQ1BCN1BLR2ZUYUpnd3JwSzJDWQ==","email":"spk@redhat.com"},"registry.redhat.io":{"auth":"fHVoYy1wb29sLWYzZjJiMzhkLTdhMjAtNGZmMi1iZmM0LTU2ZWFiZDhhNWJkODpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSTBaREkwTlRFeU1EazJPRFUwTURZd1ltRmtabU14WTJWbU1qUm1aR0kwTUNKOS5iQ3R2TjMzUE55ZEV0VE0wS0VVVlY4a3dlRGVkNUVrSEV4clJWekRjSTRmOFhFN0M1ZXpxZGdZZWRHeVlXQVNqbGV2ZFMyNkdGcUFoUU9HRnBxVmM0Rm43WEd3b2piMl84SjY4eU5nUlY1SVpaMzlfcDdFRkxNYXhjbm1rUUd1RVVwejBOUHRfV1JKNFEzMUhpUXhCbXB5WDV2M1pVRXhXeDd2dHNBWExCZElDcFlRNnhvdzkwZFp2MS1ES0FxcXBFSUdmeHJyaldIQlcwVGVIdmxZem5YRl9IdkRVbjBfQm5KcUhZSy1HUGdEZTdweU9ZdHZGbHNtRGFnLUVmdEswOHZhdUxuR1lmWGhkZG1jRUpsYm1ZUWowUmxES0x6ODFCcDkwdHJSdFZxMmppYXowaDdxWWR0cUFyYjRhSWh0OUtnSnZfY3l3aFEwY3dHQnM5YjFVMjRvdjhOVW1FdnZqTFlvaGk0c2s4SWFzS2RwaG1TSElONkcwVm16WFU3c0hYWHJfX2dzVnFtYXROOHB6dTFfVzVCWDd2MmRrTWkxRG9sNjlHcUkxd3R3dE9lVExlbXJwZ0RtR2JnUE1VYlJNMng4enpjS0JROUNoTklsNFYyYjdVTzB4VllUS1dOZ0MzTlpWSEZ6Z2ZUNVJPcFo1bE91ZUxqNkJNVGR4SHNBaTZVTlRxV1RqRy1DZGhzWmlGTkFTU014ZFc4YzAwZnNuUmg4Vld3VDZKX05XYkt1LUExZTFGcGpsVDhDMndvOHNHdmVWdzhpWEtteWplSGFtTUlFVzduMHZWUnZ6RmJfSC1zVmsyVHlSOGJUUVpXSlQxanJ1cEQ4Wi1iZ244X2wxQ2k2R0lhTm8xNHVlZ3Mta0x3Ym9BM0dPQ1BCN1BLR2ZUYUpnd3JwSzJDWQ==","email":"spk@redhat.com"}}}'

#Get it from https://oauth-openshift.apps.ci.l2s4.p1.openshiftapps.com/oauth/token/display
export NEXTGEN_INTERNAL_CI_TOKEN='sha256~VPMgwy4NBmK5YJbLI9v5rak2eNcv4ZnuZ-aBrF17EWk'


cat > $HOME/dev-scripts/config_$USER.sh << 'EOF_INNER'
set +x
export CI_TOKEN=${NEXTGEN_INTERNAL_CI_TOKEN}
set -x
export WORKING_DIR=/home/dev-scripts
export OPENSHIFT_RELEASE_STREAM=4.14.1
export OPENSHIFT_RELEASE_TYPE=ga
export OPENSHIFT_VERSION=4.14.1
export CLUSTER_NAME="${NEXTGEN_OCP_CLUSTER_NAME}"
export BASE_DOMAIN="openstack.lab"
export IP_STACK=v4
export NTP_SERVERS="clock.corp.redhat.com"
export PROVISIONING_NETWORK_PROFILE=Managed
export PROVISIONING_HOST_EXTERNAL_IP="${NEXTGEN_HYPERVISOR_IP}"
export PROVISIONING_URL_HOST=${NEXTGEN_HYPERVISOR_IP}
export EXT_IF="${NEXTGEN_HYPERVISOR_EXTERNAL_NETWORK}"
export PRO_IF="${NEXTGEN_HYPERVISOR_BAREMETAL_PROVISIONING_INTERFACE}"
export INT_IF="${NEXTGEN_HYPERVISOR_BAREMETAL_INTERNAL_INTERFACE}"
export EXTERNAL_SUBNET_V4="${NEXTGEN_OCP_EXTERNAL_SUBNET}"
export NETWORK_TYPE="OpenShiftSDN"
export CLUSTER_SUBNET_V4="${NEXTGEN_OCP_CLUSTER_SUBNET}"
export CLUSTER_HOST_PREFIX_V4="${NEXTGEN_OCP_CLUSTER_HOST_PREFIX}"
export SERVICE_SUBNET_V4="${NEXTGEN_OCP_SERVICE_SUBNET}"
export PROVISIONING_NETWORK="${NEXTGEN_OCP_OSP_PROVISIONING_NETWORK}"
#export EXTRA_NETWORK_NAMES="OSP_TRUNK"
export EXTRA_NETWORK_NAMES="OSP_TRUNK external"
export OSP_TRUNK_NETWORK_SUBNET_V4='192.168.122.0/24'
export EXTERNAL_NETWORK_SUBNET_V4='192.168.10.0/24'
export BMC_DRIVER=ipmi
export SSH_PUB_KEY="$(cat ${HOME}/.ssh/id_rsa.pub)"
# Deploy 3 nodes OpenShift, masters are workers
export NUM_MASTERS=1
export MASTER_MEMORY=65356
export MASTER_DISK=100
export MASTER_VCPU=16
export NUM_WORKERS=0
EOF_INNER

echo $NEXTGEN_PULL_SECRET > $HOME/dev-scripts/pull_secret.json
